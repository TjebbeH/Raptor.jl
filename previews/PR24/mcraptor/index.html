<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Run McRaptor · Raptor.jl</title><meta name="title" content="Run McRaptor · Raptor.jl"/><meta property="og:title" content="Run McRaptor · Raptor.jl"/><meta property="twitter:title" content="Run McRaptor · Raptor.jl"/><meta name="description" content="Documentation for Raptor.jl."/><meta property="og:description" content="Documentation for Raptor.jl."/><meta property="twitter:description" content="Documentation for Raptor.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Raptor.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Getting started</span><ul><li><a class="tocitem" href="../timetable/">Create Timetable</a></li><li class="is-active"><a class="tocitem" href>Run McRaptor</a><ul class="internal"><li><a class="tocitem" href="#Load-TimeTable"><span>Load <code>TimeTable</code></span></a></li><li><a class="tocitem" href="#Journey-options-for-one-specific-departure-time"><span>Journey options for one specific departure time</span></a></li><li><a class="tocitem" href="#Journey-options-for-a-range-of-departure-times"><span>Journey options for a range of departure times</span></a></li><li><a class="tocitem" href="#Calculate-all-journey-options-at-a-given-date."><span>Calculate all journey options at a given date.</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../toy_example/">Toy example</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting started</a></li><li class="is-active"><a href>Run McRaptor</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Run McRaptor</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TjebbeH/Raptor.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TjebbeH/Raptor.jl/blob/main/docs/src/mcraptor.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="McRaptor"><a class="docs-heading-anchor" href="#McRaptor">McRaptor</a><a id="McRaptor-1"></a><a class="docs-heading-anchor-permalink" href="#McRaptor" title="Permalink"></a></h1><p>McRaptor is the multi-criteria version of Raptor. Below it is shown how to calculate</p><ol><li>A journey from an origin station to a destination station at a given departure time.</li><li>All journeys from an origin station to a destination station in a range of departure times.</li><li>All journeys from every origin to every destination on a given date. </li></ol><h2 id="Load-TimeTable"><a class="docs-heading-anchor" href="#Load-TimeTable">Load <code>TimeTable</code></a><a id="Load-TimeTable-1"></a><a class="docs-heading-anchor-permalink" href="#Load-TimeTable" title="Permalink"></a></h2><p>Assuming we already saved a timetable load the timetable (otherwise follow the steps in <a href="../timetable/#Timetable">Timetable</a>).</p><pre><code class="language-julia hljs">timetable = load_timetable(); </code></pre><h2 id="Journey-options-for-one-specific-departure-time"><a class="docs-heading-anchor" href="#Journey-options-for-one-specific-departure-time">Journey options for one specific departure time</a><a id="Journey-options-for-one-specific-departure-time-1"></a><a class="docs-heading-anchor-permalink" href="#Journey-options-for-one-specific-departure-time" title="Permalink"></a></h2><h3 id="Create-McRaptorQuery"><a class="docs-heading-anchor" href="#Create-McRaptorQuery">Create McRaptorQuery</a><a id="Create-McRaptorQuery-1"></a><a class="docs-heading-anchor-permalink" href="#Create-McRaptorQuery" title="Permalink"></a></h3><p>Let us plan a journey from Utrecht Overvecht to Zwolle at 13h on 2024-07-01. We first create a query as below.</p><pre><code class="language-julia hljs">date = Date(2024,7,1)
origin = &quot;UTO&quot; # Utrecht Overvecht
destination = &quot;ZL&quot; # Zwolle
departure_time = date + Time(13);

# Create query for algorithm
query = McRaptorQuery(origin, departure_time, timetable);</code></pre><p>Note that the destination is not an argument of the constructor <code>McRaptorQuery</code>.  The reason is that Raptor calculates journeys to all destinations at onces.  So, later we will select the journeys arriving at Groningen.</p><h3 id="Run-McRaptor-and-reconstruct-the-journeys"><a class="docs-heading-anchor" href="#Run-McRaptor-and-reconstruct-the-journeys">Run McRaptor and reconstruct the journeys</a><a id="Run-McRaptor-and-reconstruct-the-journeys-1"></a><a class="docs-heading-anchor-permalink" href="#Run-McRaptor-and-reconstruct-the-journeys" title="Permalink"></a></h3><p>To calculate the journey options we run the following code.</p><pre><code class="language-julia hljs"># Run algorithm
bag_round_stop, last_round = run_mc_raptor(timetable, query);

# Reonstruct journeys from bags resulting from mc raptor
origin_station = timetable.stations[origin]
destination_station = timetable.stations[destination]
journeys = reconstruct_journeys(origin_station, destination_station, bag_round_stop, last_round);

# Convert vector of journeys to dataframe
df = journey_leg_dataframe(journeys);

# Print dataframe
println(df)</code></pre><p>The first line runs the round based algorithm and returns the resulting so called round bags. The second line reconstructs journeys to the specified destination from these round bags. The resulting object <code>journeys</code> is a vector of <code>Journey</code>s.  This is converted to a dataframe and printed.</p><h2 id="Journey-options-for-a-range-of-departure-times"><a class="docs-heading-anchor" href="#Journey-options-for-a-range-of-departure-times">Journey options for a range of departure times</a><a id="Journey-options-for-a-range-of-departure-times-1"></a><a class="docs-heading-anchor-permalink" href="#Journey-options-for-a-range-of-departure-times" title="Permalink"></a></h2><p>Let us now calculate all journey options from Vlissingen between 9h and 15h on 2024-07-01 and print those to Groningen (abbreviation &#39;GN&#39;). This works almost the same as above, only now we create a <code>RangeMcRaptorQuery</code>. </p><pre><code class="language-julia hljs">timetable = load_timetable();

# Create range query
date = Date(2024,7,1)
origin = &quot;VS&quot; # Vlissingen
departure_time_min = date + Time(9)
departure_time_max = date + Time(15)

range_query = RangeMcRaptorQuery(origin, departure_time_min, departure_time_max, timetable);

# Run mcraptor
journeys = run_mc_raptor_and_construct_journeys(timetable, range_query);

# Convert result to dataframes
df_legs = journey_leg_dataframe(journeys);
df_journeys = journey_dataframe(journeys);

# Filter journeys to specific destination
destination =&quot;GN&quot;; # Groningen
df_journeys_to_dest = filter(:destination =&gt; ==(destination), df_journeys);

# Check legs of first journey
journey_hash = first(df_journeys_to_dest.journey_hash);
legs_of_first_journey = filter(:journey_hash =&gt; ==(journey_hash), df_legs);

# print Journeys and the legs of the first journey option
println(df_journeys_to_dest)
println(legs_of_first_journey)</code></pre><h2 id="Calculate-all-journey-options-at-a-given-date."><a class="docs-heading-anchor" href="#Calculate-all-journey-options-at-a-given-date.">Calculate all journey options at a given date.</a><a id="Calculate-all-journey-options-at-a-given-date.-1"></a><a class="docs-heading-anchor-permalink" href="#Calculate-all-journey-options-at-a-given-date." title="Permalink"></a></h2><p>Let us calculate all (non dominated) journey options between any two stations on 2024-07-01. We can fix the maximum number of transfers passengers take.  This sets a bound on the number of rounds the algorithm. Below we assume passengers do not take journeys with more than 5 transfers. We use 4 parallel processes for the calculation.</p><pre><code class="language-julia hljs">using Distributed
addprocs(4)

# Broadcast the package and timetable to all workers
@everywhere begin
    using Raptor

    timetable = load_timetable();
end

using Dates
date = Date(2024, 7, 1);
maximum_transfers = 5;
journeys = calculate_all_journeys(timetable, date, maximum_transfers);

# Save output
Parquet2.writefile(&quot;journey_legs.parquet&quot;, journeys)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../timetable/">« Create Timetable</a><a class="docs-footer-nextpage" href="../toy_example/">Toy example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Saturday 22 February 2025 16:14">Saturday 22 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
